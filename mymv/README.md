# 🎬 Multiview.py - 멀티뷰 3D 모델 생성 가이드

## 📋 개요

`multiview.py`는 **여러 각도의 2D 이미지**를 입력받아 더 정확한 3D 모델을 생성하는 스크립트입니다.

### 🆚 단일 이미지 vs 멀티뷰 비교

| 항목 | color.py (단일 이미지) | multiview.py (멀티뷰) |
|------|------------------------|----------------------|
| 입력 | 1개 이미지 | 2-4개 이미지 (다양한 각도) |
| 모델 | Hunyuan3D-DiT-v2-0-Turbo | Hunyuan3D-DiT-v2-mv-Turbo |
| 형상 정확도 | 중간 | **높음** (더 정확한 3D 형상) |
| 숨겨진 부분 | 추론으로 생성 | **실제 데이터 기반** |
| 처리 시간 | 빠름 (~5-10초) | 약간 느림 (~10-20초) |
| 사용 시나리오 | 빠른 프로토타입 | **정확한 3D 스캔** |

---

## 📂 디렉토리 구조

```
Hunyuan3D-2/
├── multiview.py          # 멀티뷰 생성 스크립트
└── mymv/
    ├── input/            # 입력 이미지 폴더
    │   ├── front.png     # 필수: 정면 이미지
    │   ├── left.png      # 권장: 좌측 이미지
    │   ├── back.png      # 권장: 후면 이미지
    │   └── right.png     # 선택: 우측 이미지
    ├── output/           # 생성된 .glb 파일
    └── log/              # 로그 파일
```

---

## 🎯 입력 이미지 준비 가이드

### 필수 요구사항

1. **최소 2개 이미지** (권장: 3-4개)
2. **다양한 각도**에서 촬영
3. **동일한 객체**를 다른 방향에서 촬영
4. **일관된 조명** 및 배경

### 권장 뷰 구성

#### 🌟 최소 구성 (2개)
- `front`: 정면
- `back`: 후면

#### ⭐ 권장 구성 (3개)
- `front`: 정면 (0°)
- `left`: 좌측 (90° 회전)
- `back`: 후면 (180° 회전)

#### 💎 최적 구성 (4개)
- `front`: 정면 (0°)
- `left`: 좌측 (90° 회전)
- `back`: 후면 (180° 회전)
- `right`: 우측 (270° 회전)

### 촬영 가이드라인

```
     [위에서 본 촬영 위치]

         front (0°)
            |
            ↓
    left ← [객체] → right
   (90°)            (270°)
            ↑
            |
         back (180°)
```

**주의사항**:
- 각 이미지는 **동일한 거리**에서 촬영
- 객체의 **크기가 비슷**하게 유지
- **배경은 단순**하게 (자동 제거 가능)
- **조명은 균일**하게

---

## ⚙️ 설정 파라미터

### 입력 이미지 설정

```python
INPUT_IMAGES = {
    "front": "mymv/input/front.png",      # 필수
    "left": "mymv/input/left.png",        # 선택
    "back": "mymv/input/back.png",        # 선택
    "right": "mymv/input/right.png",      # 선택 (주석 처리됨)
}
```

**사용하지 않는 뷰는 주석 처리**하거나 삭제하세요.

### 형상 생성 파라미터

#### OCTREE_RESOLUTION (기본값: 380)
- **256**: 빠름, 낮은 디테일
- **380**: 균형 ⭐ (권장)
- **512**: 느림, 최고 디테일

💡 **Tip**: 멀티뷰는 단일 이미지보다 높은 해상도를 사용합니다.

#### NUM_INFERENCE_STEPS (기본값: 5)
- **3**: 매우 빠름
- **5**: 균형 ⭐ (권장)
- **8-10**: 높은 품질

#### NUM_CHUNKS (기본값: 20000)
- 메모리 관리를 위한 청크 수
- **높을수록**: 더 빠름 (메모리 많이 사용)
- **낮을수록**: 느림 (메모리 절약)

#### USE_FLASH_VDM (기본값: True)
- FlashVDM 최적화 활성화
- **True**: 속도 향상 ⚡
- **False**: 기본 속도

---

## 🚀 사용 방법

### 1단계: 이미지 준비

```bash
# mymv/input 폴더에 이미지 복사
mymv/input/
├── front.png
├── left.png
└── back.png
```

### 2단계: 설정 조정 (선택)

`multiview.py` 파일을 열고 필요한 파라미터 수정:

```python
# 빠른 생성 (프로토타입)
NUM_INFERENCE_STEPS = 3
OCTREE_RESOLUTION = 256
CAMERA_VIEWS = 'minimal'

# 균형 설정 (권장)
NUM_INFERENCE_STEPS = 5
OCTREE_RESOLUTION = 380
CAMERA_VIEWS = 'fast'

# 최고 품질
NUM_INFERENCE_STEPS = 8
OCTREE_RESOLUTION = 512
CAMERA_VIEWS = 'standard'
```

### 3단계: 실행

```bash
python multiview.py
```

### 4단계: 결과 확인

- **출력 파일**: `mymv/output/multiview_model.glb`
- **로그 파일**: `mymv/log/YYYYMMDD_HHMMSS_multiview_model.txt`

---

## 📊 처리 단계

```
[1] 멀티뷰 이미지 로드 및 배경 제거
    ↓
[2] 멀티뷰 형상 생성 파이프라인 로드
    - Hunyuan3D-DiT-v2-mv-Turbo
    - FlashVDM 최적화
    ↓
[3] 3D 형상 생성
    - 여러 각도의 정보를 통합
    - 더 정확한 3D 구조 생성
    ↓
[4] 텍스처 생성 파이프라인 로드
    ↓
[5] 텍스처 입히기 (정면 이미지 기준)
    - 11단계 상세 프로세스
    - 자동 로깅
    ↓
[6] 최종 .glb 파일 저장
```

---

## ⏱️ 예상 소요 시간

### 설정별 예상 시간

| 설정 | Octree | Views | 형상 생성 | 텍스처 생성 | 총 시간 |
|------|--------|-------|----------|------------|---------|
| 빠름 | 256 | 3뷰 | 8초 | 180초 | ~200초 |
| 균형 | 380 | 4뷰 | 15초 | 350초 | ~400초 |
| 표준 | 380 | 6뷰 | 15초 | 420초 | ~470초 |
| 고품질 | 512 | 6뷰 | 25초 | 800초 | ~900초 |

**참고**: 멀티뷰 형상 생성은 단일 이미지보다 약간 오래 걸리지만, **품질이 크게 향상**됩니다.

---

## 🎨 품질 최적화 팁

### 입력 이미지 품질

1. **고해상도 이미지**: 512×512 이상 권장
2. **선명한 초점**: 흐릿한 이미지 피하기
3. **균일한 조명**: 그림자 최소화
4. **단순한 배경**: 자동 제거 용이

### 파라미터 튜닝

#### 빠른 테스트
```python
NUM_INFERENCE_STEPS = 3
OCTREE_RESOLUTION = 256
USE_FLASH_VDM = True
CAMERA_VIEWS = 'minimal'
```

#### 프로덕션 품질
```python
NUM_INFERENCE_STEPS = 8
OCTREE_RESOLUTION = 512
USE_FLASH_VDM = True
CAMERA_VIEWS = 'standard'
TEXTURE_SIZE = 4096
```

---

## 🔧 문제 해결

### 이미지가 2개 미만
**증상**: "최소 2개 이상의 이미지가 필요합니다" 오류
**해결**: `mymv/input`에 최소 2개 이미지 준비

### 메모리 부족
**증상**: CUDA out of memory
**해결**:
```python
OCTREE_RESOLUTION = 256  # 낮춤
NUM_CHUNKS = 10000       # 낮춤
TEXTURE_SIZE = 1024      # 낮춤
```

### 형상이 이상함
**증상**: 뒤틀리거나 왜곡된 3D 모델
**해결**:
1. 입력 이미지 각도 확인 (일관성 있게)
2. 배경 제거 품질 확인
3. `NUM_INFERENCE_STEPS` 증가 (5 → 8)

### 처리가 너무 느림
**증상**: 10분 이상 소요
**해결**:
```python
OCTREE_RESOLUTION = 256
NUM_INFERENCE_STEPS = 3
CAMERA_VIEWS = 'minimal'
```

---

## 📈 단일 vs 멀티뷰 사용 시나리오

### color.py (단일 이미지) 추천

✅ 빠른 프로토타입  
✅ 간단한 객체  
✅ 정면만 중요한 경우  
✅ 배치 처리 (여러 이미지)

### multiview.py (멀티뷰) 추천

✅ 정확한 3D 스캔 필요  
✅ 복잡한 형상  
✅ 모든 각도가 중요  
✅ 프로덕션 품질 모델  
✅ 게임/AR/VR 에셋

---

## 📝 로그 파일 예시

```
============================================================
Hunyuan3D-2 멀티뷰 3D 모델 생성 로그
============================================================
생성 일시: 2025-11-01 15:30:45

============================================================
📷 입력 멀티뷰 이미지
============================================================
  ✓ front     : mymv/input/front.png
  ✓ left      : mymv/input/left.png
  ✓ back      : mymv/input/back.png
============================================================

============================================================
📊 GPU 상태 확인:
    - delight_model 디바이스: cuda:0
    - multiview_model 디바이스: cuda:0
    - GPU 메모리 사용: 11.47 GB
============================================================

============================================================
📊 처리 시간 요약
============================================================
  이미지 전처리             :   3.25초 (  0.7%)
  파이프라인 로드            :  22.18초 (  4.9%)
  형상 생성               :  18.42초 (  4.1%)
  텍스처 파이프라인 로드        :  19.15초 (  4.2%)
  텍스처 생성              : 385.67초 ( 85.3%)
  파일 저장               :   0.52초 (  0.1%)
------------------------------------------------------------
  총 소요 시간             : 452.19초
============================================================

============================================================
⚙️  사용된 설정값
============================================================
  입력 이미지 뷰      : ['front', 'left', 'back']
  출력 파일          : mymv/output/multiview_model.glb
  배경 제거          : 활성화
------------------------------------------------------------
  [멀티뷰 형상 생성]
    모델              : Hunyuan3D-DiT-v2-mv-Turbo
    FlashVDM 최적화   : 활성화
    추론 단계         : 5
    Octree 해상도     : 380
    청크 수           : 20000
    가이던스 스케일    : 5
------------------------------------------------------------
  [텍스처 생성]
    Delight 추론 단계 : 6
    Multiview 추론 단계: 6
    카메라 뷰 모드     : fast
    렌더 해상도       : 2048 x 2048
    텍스처 해상도      : 2048 x 2048
============================================================
```

---

## 🎓 고급 사용법

### 특정 뷰만 사용

```python
# 정면과 후면만 사용 (2뷰)
INPUT_IMAGES = {
    "front": "mymv/input/front.png",
    "back": "mymv/input/back.png",
}
```

### 출력 파일명 변경

```python
output_basename = 'my_custom_model'
# 출력: mymv/output/my_custom_model.glb
```

### GPU 메모리 최적화

```python
# 작은 GPU용 (8GB)
OCTREE_RESOLUTION = 256
NUM_CHUNKS = 10000
RENDER_SIZE = 1024
TEXTURE_SIZE = 1024
CAMERA_VIEWS = 'minimal'

# 큰 GPU용 (24GB+)
OCTREE_RESOLUTION = 512
NUM_CHUNKS = 30000
RENDER_SIZE = 4096
TEXTURE_SIZE = 4096
CAMERA_VIEWS = 'standard'
```

---

## 🔮 향후 개선 계획

- [ ] 자동 뷰 정렬 (이미지 각도 자동 감지)
- [ ] 5개 이상 뷰 지원
- [ ] 배치 처리 모드
- [ ] 실시간 프리뷰
- [ ] 품질 자동 평가

---

**작성일**: 2025-11-01  
**버전**: 1.0  
**모델**: Hunyuan3D-DiT-v2-mv-Turbo + Hunyuan3D-Paint-v2-0-Turbo
